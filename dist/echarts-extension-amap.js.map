{"version":3,"file":"echarts-extension-amap.js","sources":["../src/helper.js","../src/AMapCoordSys.js","../src/AMapModel.js","../src/AMapView.js","../src/index.js","../index.js"],"sourcesContent":["import { version } from 'echarts/lib/echarts'\n\nexport const ecVer = version.split('.')\n\nexport const isNewEC = ecVer[0] > 4\n\n/* global AMap */\n\n// `AMap.version` only exists in AMap 2.x\n// For AMap 1.x, it's `AMap.v`\n// use function instead of constant to allow importing the plugin before AMap is loaded\nexport const isAMap2X = () => AMap.version >= 2\n\nexport function v2Equal(a, b) {\n  return a && b && a[0] === b[0] && a[1] === b[1]\n}\n\nlet logMap = {}\n\nexport function logWarn(tag, msg, once) {\n  const log = `[ECharts][Extension][AMap]${tag ? ' ' + tag + ':' : ''} ${msg}`\n  once && logMap[log] || console.warn(log)\n  once && (logMap[log] = true)\n}\n\nexport function clearLogMap() {\n  logMap = {}\n}\n","import { util as zrUtil, graphic, matrix } from 'echarts/lib/echarts'\nimport { logWarn } from './helper'\n\nfunction dataToCoordSize(dataSize, dataItem) {\n  dataItem = dataItem || [0, 0];\n  return zrUtil.map(\n    [0, 1],\n    function(dimIdx) {\n      const val = dataItem[dimIdx]\n      const halfSize = dataSize[dimIdx] / 2\n      const p1 = []\n      const p2 = []\n      p1[dimIdx] = val - halfSize\n      p2[dimIdx] = val + halfSize\n      p1[1 - dimIdx] = p2[1 - dimIdx] = dataItem[1 - dimIdx]\n      return Math.abs(\n        this.dataToPoint(p1)[dimIdx] - this.dataToPoint(p2)[dimIdx]\n      )\n    },\n    this\n  )\n}\n\n// exclude private and unsupported options\nconst excludedOptions = [\n  'echartsLayerZIndex', // DEPRECATED since v1.9.0\n  'echartsLayerInteractive',\n  'renderOnMoving',\n  'largeMode',\n  'returnMapCameraState',\n  'layers'\n]\n\nfunction AMapCoordSys(amap, api) {\n  this._amap = amap\n  this._api = api\n  this._mapOffset = [0, 0]\n  // this.dimensions = ['lng', 'lat']\n}\n\nconst AMapCoordSysProto = AMapCoordSys.prototype\n\nAMapCoordSysProto.setZoom = function(zoom) {\n  this._zoom = zoom\n}\n\nAMapCoordSysProto.setCenter = function(center) {\n  const lnglat = new AMap.LngLat(center[0], center[1])\n  this._center = this._amap.lngLatToContainer(lnglat)\n}\n\nAMapCoordSysProto.setMapOffset = function(mapOffset) {\n  this._mapOffset = mapOffset\n}\n\nAMapCoordSysProto.setAMap = function(amap) {\n  this._amap = amap\n}\n\nAMapCoordSysProto.getAMap = function() {\n  return this._amap\n}\n\nAMapCoordSysProto.dataToPoint = function(data) {\n  const lnglat = new AMap.LngLat(data[0], data[1])\n  const px = this._amap.lngLatToContainer(lnglat)\n  const mapOffset = this._mapOffset\n  return [px.x - mapOffset[0], px.y - mapOffset[1]]\n}\n\nAMapCoordSysProto.pointToData = function(pt) {\n  const mapOffset = this._mapOffset\n  const lnglat = this._amap.containerToLngLat(\n    new AMap.Pixel(\n      pt[0] + mapOffset[0],\n      pt[1] + mapOffset[1]\n    )\n  )\n  return [lnglat.lng, lnglat.lat]\n}\n\nAMapCoordSysProto.getViewRect = function() {\n  const api = this._api\n  return new graphic.BoundingRect(0, 0, api.getWidth(), api.getHeight())\n}\n\nAMapCoordSysProto.getRoamTransform = function() {\n  return matrix.create()\n}\n\nAMapCoordSysProto.prepareCustoms = function() {\n  const rect = this.getViewRect()\n  return {\n    coordSys: {\n      // The name exposed to user is always 'cartesian2d' but not 'grid'.\n      type: 'amap',\n      x: rect.x,\n      y: rect.y,\n      width: rect.width,\n      height: rect.height\n    },\n    api: {\n      coord: zrUtil.bind(this.dataToPoint, this),\n      size: zrUtil.bind(dataToCoordSize, this)\n    }\n  }\n}\n\nAMapCoordSysProto.convertToPixel = function(ecModel, finder, value) {\n  // here we don't use finder as only one amap component is allowed\n  return this.dataToPoint(value);\n}\n\nAMapCoordSysProto.convertFromPixel = function(ecModel, finder, value) {\n  // here we don't use finder as only one amap component is allowed\n  return this.pointToData(value);\n}\n\n// less useful\n// AMapCoordSysProto.containPoint = function(point) {\n//   return this._amap.getBounds().contains(this.pointToData(point));\n// }\n\nAMapCoordSys.create = function(ecModel, api) {\n  let amapCoordSys\n  ecModel.eachComponent('amap', function(amapModel) {\n    if (typeof AMap === 'undefined') {\n      throw new Error('AMap api is not loaded')\n    }\n    if (amapCoordSys) {\n      throw new Error('Only one amap component is allowed')\n    }\n    let amap = amapModel.getAMap()\n    const echartsLayerInteractive = amapModel.get('echartsLayerInteractive')\n    if (!amap) {\n      const root = api.getDom()\n      const painter = api.getZr().painter\n      const viewportRoot = painter.getViewportRoot()\n      viewportRoot.className = 'amap-ec-layer'\n      // PENDING not hidden?\n      viewportRoot.style.visibility = 'hidden'\n      // Not support IE8\n      let amapRoot = root.querySelector('.ec-extension-amap')\n      if (amapRoot) {\n        // Reset viewport left and top, which will be changed\n        // in moving handler in AMapView\n        viewportRoot.style.left = '0px'\n        viewportRoot.style.top = '0px'\n        root.removeChild(amapRoot)\n      }\n      amapRoot = document.createElement('div')\n      amapRoot.className = 'ec-extension-amap'\n      amapRoot.style.cssText = 'position:absolute;top:0;left:0;bottom:0;right:0;'\n      root.appendChild(amapRoot)\n\n      const options = zrUtil.clone(amapModel.get())\n      if ('echartsLayerZIndex' in options) {\n        logWarn('DEPRECATED', 'the option `echartsLayerZIndex` has been removed since v1.9.0, use `echartsLayerInteractive` instead.')\n      }\n      // delete excluded options\n      zrUtil.each(excludedOptions, function(key) {\n        delete options[key]\n      })\n\n      amap = new AMap.Map(amapRoot, options)\n\n      // PENDING: should update the model option when the user call map.setXXX?\n\n      // const nativeSetMapStyle = amap.setMapStyle\n      // const nativeSetLang = amap.setLang\n\n      // // PENDING\n      // amap.setMapStyle = function () {\n      //   nativeSetMapStyle.apply(this, arguments)\n      //   amapModel.__mapStyle = amap.getMapStyle()\n      // }\n\n      // // PENDING\n      // nativeSetLang && (amap.setLang = function() {\n      //   nativeSetLang.apply(this, arguments)\n      //   amapModel.__mapLang = amap.getLang()\n      // })\n\n      // use `complete` callback to avoid NPE when first load amap\n      amap.on('complete', function() {\n        amapRoot.querySelector('.amap-maps').appendChild(viewportRoot)\n        // PENDING\n        viewportRoot.style.visibility = ''\n      })\n\n      amapModel.setAMap(amap)\n      amapModel.setEChartsLayer(viewportRoot)\n\n      // Override\n      painter.getViewportRootOffset = function() {\n        return { offsetLeft: 0, offsetTop: 0 }\n      }\n    }\n\n    const oldEChartsLayerInteractive = amapModel.__echartsLayerInteractive\n    if (oldEChartsLayerInteractive !== echartsLayerInteractive) {\n      amapModel.setEChartsLayerInteractive(echartsLayerInteractive)\n      amapModel.__echartsLayerInteractive = echartsLayerInteractive\n    }\n\n    const center = amapModel.get('center')\n    const zoom = amapModel.get('zoom')\n    if (center && zoom) {\n      const amapCenter = amap.getCenter()\n      const amapZoom = amap.getZoom()\n      const centerOrZoomChanged = amapModel.centerOrZoomChanged(\n        [amapCenter.lng, amapCenter.lat],\n        amapZoom\n      )\n      if (centerOrZoomChanged) {\n        amap.setZoomAndCenter(zoom, new AMap.LngLat(center[0], center[1]))\n      }\n    }\n\n    // update map style(#13)\n    const originalMapStyle = amapModel.__mapStyle\n    const newMapStyle = amapModel.get('mapStyle')\n    if (originalMapStyle !== newMapStyle) {\n      amap.setMapStyle(amapModel.__mapStyle = newMapStyle)\n    }\n\n    // update map lang\n    // PENDING: AMap 2.x does not support `setLang` yet\n    if (amap.setLang) {\n      const originalMapLang = amapModel.__mapLang\n      const newMapLang = amapModel.get('lang')\n      if (originalMapLang !== newMapLang) {\n        amap.setLang(amapModel.__mapLang = newMapLang)\n      }\n    }\n    else {\n      logWarn('CAVEAT', 'The current map doesn\\'t support `setLang` API!', true)\n    }\n\n    amapCoordSys = new AMapCoordSys(amap, api)\n    amapCoordSys.setMapOffset(amapModel.__mapOffset || [0, 0])\n    amapCoordSys.setZoom(zoom)\n    amapCoordSys.setCenter(center)\n\n    amapModel.coordinateSystem = amapCoordSys\n  })\n\n  ecModel.eachSeries(function(seriesModel) {\n    if (seriesModel.get('coordinateSystem') === 'amap') {\n      // inject coordinate system\n      seriesModel.coordinateSystem = amapCoordSys\n    }\n  })\n\n  // return created coordinate systems\n  return amapCoordSys && [amapCoordSys]\n}\n\nAMapCoordSysProto.dimensions = AMapCoordSys.dimensions = ['lng', 'lat']\n\nAMapCoordSysProto.type = 'amap'\n\n\nexport default AMapCoordSys\n","import { ComponentModel } from 'echarts/lib/echarts'\nimport { isNewEC, v2Equal } from './helper'\n\nconst AMapModel = {\n  type: 'amap',\n\n  setAMap(amap) {\n    this.__amap = amap\n  },\n\n  getAMap() {\n    return this.__amap\n  },\n\n  setEChartsLayer(layer) {\n    this.__echartsLayer = layer\n  },\n\n  getEChartsLayer() {\n    return this.__echartsLayer\n  },\n\n  setEChartsLayerVisiblity(visible) {\n    this.__echartsLayer.style.display = visible ? 'block' : 'none'\n  },\n\n  // FIXME: NOT SUPPORT <= IE 10\n  setEChartsLayerInteractive(interactive) {\n    this.option.echartsLayerInteractive = !!interactive\n    this.__echartsLayer.style.pointerEvents = interactive ? 'auto' : 'none'\n  },\n\n  setCenterAndZoom(center, zoom) {\n    this.option.center = center\n    this.option.zoom = zoom\n  },\n\n  centerOrZoomChanged(center, zoom) {\n    const option = this.option\n    return !(v2Equal(center, option.center) && zoom === option.zoom)\n  },\n\n  defaultOption: {\n    center: [116.397428, 39.90923],\n    zoom: 5,\n    isHotspot: false,\n    resizeEnable: true,\n\n    // extension specific options\n    // echartsLayerZIndex: 2000, // DEPRECATED since v1.9.0\n    echartsLayerInteractive: true,\n    renderOnMoving: true,\n    largeMode: false,\n    // since v1.10.0\n    returnMapCameraState: false\n  }\n}\n\nexport default isNewEC\n  ? ComponentModel.extend(AMapModel)\n  : AMapModel\n","import { ComponentView, getInstanceByDom, throttle } from 'echarts/lib/echarts'\nimport { isNewEC, isAMap2X, clearLogMap } from './helper'\n\nlet _isAMap2X\n\nconst AMapView = {\n  type: 'amap',\n\n  init() {\n    this._isFirstRender = true\n\n    _isAMap2X = isAMap2X()\n  },\n\n  render(amapModel, ecModel, api) {\n    let rendering = true\n\n    const amap = amapModel.getAMap()\n    const viewportRoot = api.getZr().painter.getViewportRoot()\n    const offsetEl = amap.getContainer()\n    const coordSys = amapModel.coordinateSystem\n\n    const renderOnMoving = amapModel.get('renderOnMoving')\n    const resizeEnable = amapModel.get('resizeEnable')\n    const largeMode = amapModel.get('largeMode')\n    const returnMapCameraState = amapModel.get('returnMapCameraState')\n\n    const viewMode = amap.getViewMode_()\n    const is3DMode = viewMode === '3D'\n\n    let moveHandler = function(e) {\n      if (rendering) {\n        return\n      }\n\n      const offsetElStyle = offsetEl.style\n      const mapOffset = [\n        -parseInt(offsetElStyle.left, 10) || 0,\n        -parseInt(offsetElStyle.top, 10) || 0\n      ]\n      // only update style when map offset changed\n      const viewportRootStyle = viewportRoot.style\n      const offsetLeft = mapOffset[0] + 'px'\n      const offsetTop = mapOffset[1] + 'px'\n      if (viewportRootStyle.left !== offsetLeft) {\n        viewportRootStyle.left = offsetLeft\n      }\n      if (viewportRootStyle.top !== offsetTop) {\n        viewportRootStyle.top = offsetTop\n      }\n\n      coordSys.setMapOffset(amapModel.__mapOffset = mapOffset)\n\n      const actionParams = {\n        type: 'amapRoam',\n        animation: {\n          // compatible with ECharts 5.x\n          // no delay for rendering but remain animation of elements\n          duration: 0\n        }\n      }\n\n      if (returnMapCameraState) {\n        e = e || {}\n        let center = e.center\n        if (!center) {\n          // normalize center LngLat to Array\n          center = amap.getCenter()\n          center = [center.lng, center.lat]\n        }\n        actionParams.camera = {\n          viewMode,\n          center,\n          zoom: e.zoom || amap.getZoom(),\n          rotation: e.rotation == null ? amap.getRotation() : e.rotation,\n          pitch: e.pitch == null ? amap.getPitch() : e.pitch,\n          scale: amap.getScale(),\n          bounds: amap.getBounds()\n        }\n      }\n\n      api.dispatchAction(actionParams)\n    }\n\n    amap.off('mapmove', this._moveHandler)\n    amap.off('moveend', this._moveHandler)\n    amap.off('viewchange', this._moveHandler)\n    amap.off('camerachange', this._moveHandler)\n    amap.off('zoom', this._moveHandler)\n\n    if (this._resizeHandler) {\n      amap.off('resize', this._resizeHandler)\n    }\n    if (this._moveStartHandler) {\n      amap.off('movestart', this._moveStartHandler)\n    }\n    if (this._moveEndHandler) {\n      amap.off('moveend', this._moveEndHandler)\n      amap.off('zoomend', this._moveEndHandler)\n    }\n\n    amap.on(\n      renderOnMoving\n        ? (_isAMap2X\n          ? 'viewchange'\n          : is3DMode\n            ? 'camerachange'\n            : 'mapmove')\n        : 'moveend',\n      // FIXME: bad performance in 1.x in the cases with large data, use debounce?\n      // moveHandler\n      (!_isAMap2X && largeMode) ? (moveHandler = throttle(moveHandler, 20, true)) : moveHandler\n    )\n\n    this._moveHandler = moveHandler\n\n    if (renderOnMoving && !(_isAMap2X && is3DMode)) {\n      // need to listen to zoom if 1.x & 2D mode\n      // FIXME: unnecessary `mapmove` event triggered when zooming\n      amap.on('zoom', moveHandler)\n    }\n\n    if (!renderOnMoving) {\n      amap.on('movestart', this._moveStartHandler = function() {\n        setTimeout(function() {\n          amapModel.setEChartsLayerVisiblity(false)\n        }, 0)\n      })\n      const moveEndHandler = this._moveEndHandler = function(e) {\n        ;(!e || e.type !== 'moveend') && moveHandler(e)\n        setTimeout(function() {\n          amapModel.setEChartsLayerVisiblity(true)\n        }, _isAMap2X || !largeMode ? 0 : 20)\n      }\n      amap.on('moveend', moveEndHandler)\n      amap.on('zoomend', moveEndHandler)\n      if (this._isFirstRender && is3DMode) {\n        // FIXME: not rewrite AMap instance method\n        const nativeSetPicth = amap.setPitch\n        const nativeSetRotation = amap.setRotation\n        amap.setPitch = function() {\n          nativeSetPicth.apply(this, arguments)\n          moveEndHandler()\n        }\n        amap.setRotation = function() {\n          nativeSetRotation.apply(this, arguments)\n          moveEndHandler()\n        }\n      }\n    }\n\n    if (resizeEnable) {\n      let resizeHandler = function() {\n        getInstanceByDom(api.getDom()).resize()\n      }\n      if (!_isAMap2X && largeMode) {\n        resizeHandler = throttle(resizeHandler, 20, true)\n      }\n      amap.on('resize', this._resizeHandler = resizeHandler)\n    }\n\n    this._isFirstRender = rendering = false\n  },\n\n  dispose() {\n    clearLogMap()\n    const component = this.__model\n    if (component) {\n      component.getAMap().destroy()\n      component.setAMap(null)\n      component.setEChartsLayer(null)\n      if (component.coordinateSystem) {\n        component.coordinateSystem.setAMap(null)\n        component.coordinateSystem = null\n      }\n      delete this._moveHandler\n      delete this._resizeHandler\n      delete this._moveStartHandler\n      delete this._moveEndHandler\n    }\n  }\n}\n\nexport default isNewEC\n  ? ComponentView.extend(AMapView)\n  : AMapView\n","/**\n * AMap component extension\n */\n\nimport AMapCoordSys from './AMapCoordSys'\nimport AMapModel from './AMapModel'\nimport AMapView from './AMapView'\nimport { isNewEC, ecVer } from './helper'\n\nexport { version, name } from '../package.json'\n\n/**\n * @typedef {import('../export').EChartsExtensionRegisters} EChartsExtensionRegisters\n */\n\n/**\n * AMap extension installer\n * @param {EChartsExtensionRegisters} registers\n */\nexport function install(registers) {\n  // add coordinate system support for pie series for ECharts < 5.4.0\n  if (!isNewEC || (ecVer[0] == 5 && ecVer[1] < 4)) {\n    registers.registerLayout(function(ecModel, api) {\n      ecModel.eachSeriesByType('pie', function (seriesModel) {\n        const coordSys = seriesModel.coordinateSystem\n        const data = seriesModel.getData()\n        const valueDim = data.mapDimension('value')\n        if (coordSys && coordSys.type === 'amap') {\n          const center = seriesModel.get('center')\n          const point = coordSys.dataToPoint(center)\n          const cx = point[0]\n          const cy = point[1]\n          data.each(valueDim, function (value, idx) {\n            const layout = data.getItemLayout(idx)\n            layout.cx = cx\n            layout.cy = cy\n          })\n        }\n      })\n    })\n  }\n  // Model\n  isNewEC\n    ? registers.registerComponentModel(AMapModel)\n    : registers.extendComponentModel(AMapModel)\n  // View\n  isNewEC\n    ? registers.registerComponentView(AMapView)\n    : registers.extendComponentView(AMapView)\n  // Coordinate System\n  registers.registerCoordinateSystem('amap', AMapCoordSys)\n  // Action\n  registers.registerAction(\n    {\n      type: 'amapRoam',\n      event: 'amapRoam',\n      update: 'updateLayout'\n    },\n    function(payload, ecModel) {\n      ecModel.eachComponent('amap', function(amapModel) {\n        const amap = amapModel.getAMap()\n        const center = amap.getCenter()\n        amapModel.setCenterAndZoom([center.lng, center.lat], amap.getZoom())\n      })\n    }\n  )\n}\n","/**\n * TODO use `echarts/core` rather than `echarts/lib/echarts`\n * to avoid self-registered `CanvasRenderer` and `DataSetComponent` in Apache ECharts 5\n * but it's not compatible with echarts v4. Leave it to 2.0.\n */\nimport * as echarts from 'echarts/lib/echarts'\nimport { install } from './src/index'\nimport { isNewEC } from './src/helper'\n\nisNewEC ? echarts.use(install) : install(echarts)\n\nexport { name, version } from './src/index'\n"],"names":["ecVer","version","split","isNewEC","isAMap2X","AMap","v2Equal","a","b","logMap","logWarn","tag","msg","once","log","console","warn","clearLogMap","dataToCoordSize","dataSize","dataItem","zrUtil","map","dimIdx","val","halfSize","p1","p2","Math","abs","dataToPoint","excludedOptions","AMapCoordSys","amap","api","_amap","_api","_mapOffset","AMapCoordSysProto","prototype","setZoom","zoom","_zoom","setCenter","center","lnglat","LngLat","_center","lngLatToContainer","setMapOffset","mapOffset","setAMap","getAMap","data","px","x","y","pointToData","pt","containerToLngLat","Pixel","lng","lat","getViewRect","graphic","BoundingRect","getWidth","getHeight","getRoamTransform","matrix","create","prepareCustoms","rect","coordSys","type","width","height","coord","bind","size","convertToPixel","ecModel","finder","value","convertFromPixel","amapCoordSys","eachComponent","amapModel","Error","echartsLayerInteractive","get","root","getDom","painter","getZr","viewportRoot","getViewportRoot","className","style","visibility","amapRoot","querySelector","left","top","removeChild","document","createElement","cssText","appendChild","options","clone","each","key","Map","on","setEChartsLayer","getViewportRootOffset","offsetLeft","offsetTop","oldEChartsLayerInteractive","__echartsLayerInteractive","setEChartsLayerInteractive","amapCenter","getCenter","amapZoom","getZoom","centerOrZoomChanged","setZoomAndCenter","originalMapStyle","__mapStyle","newMapStyle","setMapStyle","setLang","originalMapLang","__mapLang","newMapLang","__mapOffset","coordinateSystem","eachSeries","seriesModel","dimensions","AMapModel","__amap","layer","__echartsLayer","getEChartsLayer","setEChartsLayerVisiblity","visible","display","interactive","option","pointerEvents","setCenterAndZoom","defaultOption","isHotspot","resizeEnable","renderOnMoving","largeMode","returnMapCameraState","ComponentModel","extend","_isAMap2X","AMapView","init","_isFirstRender","render","rendering","offsetEl","getContainer","viewMode","getViewMode_","is3DMode","moveHandler","e","offsetElStyle","parseInt","viewportRootStyle","actionParams","animation","duration","camera","rotation","getRotation","pitch","getPitch","scale","getScale","bounds","getBounds","dispatchAction","off","_moveHandler","_resizeHandler","_moveStartHandler","_moveEndHandler","throttle","setTimeout","moveEndHandler","nativeSetPicth","setPitch","nativeSetRotation","setRotation","apply","arguments","resizeHandler","getInstanceByDom","resize","dispose","component","__model","destroy","ComponentView","install","registers","registerLayout","eachSeriesByType","getData","valueDim","mapDimension","point","cx","cy","idx","layout","getItemLayout","registerComponentModel","extendComponentModel","registerComponentView","extendComponentView","registerCoordinateSystem","registerAction","event","update","payload","echarts","use"],"mappings":"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"}